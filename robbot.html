<html>
<title>robbot</title>
<body>
	<div class="col-sm-4 col-xs-10">
	<div class="row">
		<textarea id="chatarea">
			<div style='color:blue; text-align: left; padding: 5px;'>机器人: 喂，你好</div>
			<div style='color:blue; text-align: left; padding: 5px;'>机器人: 啥？</div>
		</textarea>
	</div>

	<div id="info" style="color:#FFFFFF; height: 20px;"></div>
	<br/>

	<div class="row">
		<div class="input-group">
			<input type="text" id="input" class="form-control" autofocus="autofocus" onkeydown="submitByEnter()" />
			<span class="input-group-btn">
				<button class="btn btn-default" type="button" onclick="submit()">发送</button>
			</span>
		</div>
	</div>

	<div style="color:#959595; height: 20px;"><a target="_blank" href="www.baidu.com">baidu</a></div>
	<div class="hidden-xs" style="color: #959595; height: 20px;">觉得不好</div>
	</div>

	<script type="text/javascript">
	CKEDITOR.replace('chatarea',
		{readOnly: true,
			toolbar: ['Source'],
			height:500,
			removePlugins: 'elementspath',
			resize_enabled: false,
			allowedContent: true});
	</script>

	<script type="text/javascript">
		var showleft = false;
		var xmlHttp;
		function submit(){
			if(window.ActiveXObject){
				xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
			}else if(window.XMLHttpRequest){
				xmlHttp = new XMLHttpRequest();
			}
			var input = $("#input").val().trim();
			if(input == ''){
				jQuery('#input').val('');
				return;
			}
			addText(input, false);
			jQuery('#input').val('');
			jQuery('#info').html('机器人正在思考中，请稍后。。。');
			var datastr = "input=" + input;
			datastr = encodeURI(datastr);
			var url = "/chatbot/query";
			xmlHttp.open("POST", url, true);
			xmlHttp.onreadystatechange = callback;
			xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xmlHttp.send(datastr);
		}

		function callback(){
			if(xmlHttp.readyState == 4 && xmlHttp.status == 200){
				var responseText = xmlHttp.responseText;
				addText(responseText, true);
				jQuery("#info").html('');
			}
		}

		function addText(text, is_response){
			var oldText = CKEDITOR.instances.chatarea.getData();
			oldText = oldText.substr(0, oldText.length-7);
			if(is_response && checkSystem()!='ios' && checkSystem()!='android'){
				if(showleft == true){
					oldText = oldText.replace('nonurl', 'http://www.shareditor.com/uploads/media/default/rabbit.png');
					jQuery('#rabbit-left').css('display', 'block');
					showleft = true;
				}
			}
			var prefix = '';
			if(is_response){
				prefix = "<div style='color:blue; text-align:left; padding: 5px;'>小兔:"
			}else{
				prefix = "<div style='color:darkgreen; text-align:right; padding:5px'>我:"
			}
			CKEDITOR.instances.chatarea.setData(oldText+""+prefix+text+"</div></div>");
			window.setTimeout(scrollDown, 50);
		}

		function submitByEnter(){
			if(event.keyCode == 13){
				submit();
			}
		}

		function scrollDown(){
			var editor = CKEDITOR.instances.chatarea;
			var jqDocument = $(editor.document.$);
			var documentHeight = jqDocument.height();
			jqDocument.scrollTop(documentHeight);
		}
	</script>
</body>

</html>

github.com/warmheartli/shareditor.com/
shareditor.com/app/Resources/views/chatbot/index.html.twig